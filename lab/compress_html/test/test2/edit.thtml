<?php global $_baseurl; ?><?php echo $this->renderElement('iteration_plan_nav',array('iteration_id'=>$iteration_id));?><div id="tapd_box" onclick=""><div class="content"><form id="form_edit" enctype="multipart/form-data" class="tapd-form" style="margin-left:0" method="post" action="<?php echo $myHtml->url('/iterations/edit'); ?>"><!-- name --><div><div class="tapd-form-title"><?php echo t('Iteration Name', '/iterations') ?><span class="vip">*</span>：</div><div class="tapd-form-content"><?php echo $html->hidden('Iteration/id',array("class"=>"","value"=>empty($Iteration['id'])?'':$Iteration['id']));?><?php echo $html->input('Iteration/name', array("class"=>"tapd-txt","value"=>empty($Iteration['name'])?'':$Iteration['name'],"size"=>"66","maxlength"=>100,"style"=>"width:350px","onkeyup"=>"calculate_char_left(this.id, 'title_char_left')", "onblur"=>"calculate_char_left(this.id, 'title_char_left')")); ?><div id="IterationNameTip" class=""></div></div></div><!-- end name --><!-- StartDate --><div class="left"><div class="tapd-form-title"><label><?php echo t('Start Date', '/iterations') ?><span class="vip">*</span>：</label></div><div class="tapd-form-content"><?php echo $myHtml->dateinput('Iteration/startdate',array("class"=>"tapd-txt",'value'=>empty($Iteration['startdate'])?'':$Iteration['startdate']));?><div id="IterationStartdateTip" class=""></div></div></div><!-- end StartDate --><!-- EndDate --><div class="left"><div class="tapd-form-title"><?php echo t('End Date', '/iterations') ?><span class="vip">*</span>：</div><div class="tapd-form-content"><?php echo $myHtml->dateinput('Iteration/enddate',array("class"=>"tapd-txt",'value'=>empty($Iteration['enddate'])?'':$Iteration['enddate']));?><div id="IterationEnddateTip" class=""></div></div></div><div class="fixed"></div><!-- end EndDate --><!-- description --><div><div class="tapd-form-title"><label><?php echo t('Iteration Target', '/prong') ?>：</label></div><div id="IterationDescription" class="tapd-form-content" style="width:650px;"><?php $value = empty($Iteration['description'])?'':$Iteration['description'];?><?php echo $top->richEditor('Iteration/description]',array('id'=>'Iteration/description','value'=>$value,'height'=>'240px','width'=>'650px','needFocus'=>0));?></div></div><!-- end description --><!-- 删除创建迭代时选择是否发布的配置部分 --><!-- button --><div><div id="button" class="tapd-form-content"><?php echo $this->renderElement('edit_button',array('url'=>$myHtml->url('/iterations'),'isSaveNext'=>true,'isSaveView'=>true,'isCanelInIteration'=>true,)) ?></div></div><!-- end button--></form></div></div><!-- End page date --><?php echo $this->renderElement('helper_footer',array('name'=>'IterationHelp','sub_name'=>''));?><?php//组装表单校验的数组$field_valid = array("IterationName" => array("name" => "name", "enabled" => "1", "notnull" => "1", "label" => t("name", "/iteration") ,"html_type" => "input"),"IterationStartdate" => array("name" => "startdate", "enabled" => "1", "notnull" => "1", "label" => t("Start Date", "/iteration"), "html_type" => "dateinput"),"IterationEnddate" => array("name" => "enddate", "enabled" => "1", "notnull" => "1", "label" => t("End Date", "/iteration"), "html_type" => "dateinput"),);//生产表单校验js代码 author:emilyzhang 2009-06-05echo $this->renderElement('form_validator',array("formid"=>"form_edit","object"=>"Iteration","valid_infor"=>$field_valid));?><script type="text/javascript">var timer;$(document).ready(function(){$('#IterationReleaseId').focus();//$('#geneate_release_info').attr('checked',1);change_release_info();<?php if (!empty($this->data['Iteration']['notice'])||!empty($this->data['Iteration']['releaseowner'])||!empty($this->data['Iteration']['launchdate'])){?>//$('#geneate_release_info').attr('checked',1);change_release_info();<?php } ?>timer = setInterval(checkEditor,100);});function checkEditor(){if(typeof(fOnTBMouseOver) != 'undefined'){clearInterval(timer);checkSave('form_edit');}}/***验证页面是否保存monitorObjects 监控需要保存的标签名,如果这些标签发生改变,则触发保存确认框monitorObjects = =new Array("input","checkbox");*kuncai**/function checkSave(formID){var ISNEEDSAVE = false; $("#tapd_box input").change(function(){ISNEEDSAVE = true;});$("#button input").click(function(){ISNEEDSAVE = false;});$(".calendar").click(function(){ISNEEDSAVE = true;});if(document.frames){var iframe = document.frames["HtmlEditor"];iframe.document.attachEvent('onclick',function(){ISNEEDSAVE = true;});}else{var iframe = document.getElementById('HtmlEditor');iframe.contentWindow.document.addEventListener("click",function(){ISNEEDSAVE = true;},false);}$("#iteration_plan_nav a").click(function(){if(ISNEEDSAVE){ISNEEDSAVE = false;if(confirm("是否保存")){var action = $("#"+formID).attr('action');var href = $(this).attr('href');$("#"+formID).attr('action',action+"?ref="+href)$("#"+formID).submit();return false;}}return true;});window.onbeforeunload = function(){if(ISNEEDSAVE){return "表单未保存,离开页面将丢失数据!";}};}function change_release_info(){if($('#geneate_release_info').attr('checked')){$('#release_info').show();}else{$('#release_info').hide();}}$(document).ready(function(){$('#IterationName').focus() ;$("#select_release_template").click(function(e){Mouse(e);top = toppos + 5;$("#release_template_menu").css("top" , toppos+ + "px");$("#release_template_menu").css("left" , "95px");$("#release_template_menu").toggle();$(document).bind("click", function(){$(".g_menu").hide();$(document).unbind("click");});return false;});$("#release_template_menu a").click(function(){$("#release_template_menu").hide();});$("#user_workspace_selected").change(function(){var current_workspace = $(this).attr("value");var direct_url = "";direct_url += "<?php echo $this->webroot ?>"+"launch/"+current_workspace+"/launch_myview/forms_view/";//当前页面打开window.location.href = direct_url;//新窗口打开//window.open(direct_url,'','height=500,width=611,scrollbars=yes,status=yes');});});//计算坐标函数var Mouse = function(e){mouse = new MouseEvent(e);leftpos = mouse.x;toppos = mouse.y;}//获取鼠标坐标函数var MouseEvent = function(e) {this.x = e.pageX;this.y = e.pageY;}function select_release_template(template_id){var to_url="<?php echo $_baseurl . '/prong/iterations/get_release_template/';?>"+template_id;$.ajax({type:"GET",url:to_url,dataType:"html",success:function(msg){var data = eval("("+msg+")");if(data['releasename'])$("#releasename").val(data['notice']);if(data['notice'])$("#IterationNotice").val(data['notice']);if(data['releaseowner']){$("#IterationReleaseownerValue").val(data['releaseowner']);$("#IterationReleaseowner").val(data['releaseowner']);}if(data['launchdate']){$("#IterationLaunchdate").val(data['launchdate']);}},error:function(msg){alert ("ERROR!");}});}</script>
