<?php/*** 评论的列表* 目前仅用在task的详细页面* * @param int $containerid 调用本页面的容器的id* @param string $return_url 评论编辑后，返回的url* @param int $count 评论总数* @param array $comments 评论数据* @param  $comment_count 设置显示评论数的文字区域id* @package View.Comment*/?><?php $pass = isset($pass)?$pass:'';?><?php $return_url = isset($return_url)?$return_url.$pass:$this->params['url']['url'].$pass;?><?php $project_code = isset($project_code)?$project_code:''; ?><?php foreach($comments as $comment):$comment = $comment['Comment'];?><div class="comment_content"><span id="comment:<?php echo $comment['id'] ?>">  <a href = "#" class = "<?php echo($comment['type']=='comment')?('normal_comment'):('special_comment') ; ?>"><?php echo $comment['type'] ; ?></a>  <strong><?php echo $comment['author'];?></strong> &nbsp;<span class="time"><?php echo $comment['created'];?></span>    <span class="threading"><?php if ($comment['author']==current_user('nick')): ?> <?php if($comment['type']!='suggestion'): ?> <a title="<?php echo t("delete", "/prong")?>" style="cursor:pointer;text-decoration:underline;" onclick="delete_confirm(<?php echo $comment['id']?>);"> <?php echo t("delete", "/prong")?></a>  <?php endif; ?><?php endif; ?>    </span> </span>  <br><?php echo $this->controller->WikiFormatter->format($comment['description']) ?></div><?php endforeach; ?><?php if(empty($comments) || $comments <=0){ ?><br/><?php } ?><?php echo $this->renderElement('pager'); ?><script>$(document).ready(function(){<?php if(!empty($containerid)):?>page();<?php endif;?>$("#<?php echo $comment_count?>").html("<?php echo $count?>");<?php if($count == 1):?>$("#comment_list_link").css("display","block");<?php endif;?>});<?php if(!empty($containerid)):?>function page(){$("#<?php echo $containerid?> a.pager").each(function(){if($(this).attr("href"))$(this).attr("url", $(this).attr("href"));$(this).click(function(){$('#<?php echo $containerid?>').load($(this).attr("url"), {}, page);});$(this).removeAttr("href");$(this).css("cursor", "pointer");});}<?php endif;?>function delete_confirm(comment_id){if(window.confirm('<?php echo t("Are you sure delete?", "/prong")?>')){ $.ajax({type:"GET",url: "<?php echo $this->controller->baseurl.$this->controller->workspace['pretty_name']."/comments/delete_comment/"?>" + comment_id + "/<?php echo $this->params['url']['entry_type'];?>",dataType:"html",success:function(msg){<?php if(!empty($containerid)):?>var date = new Date();$('#<?php echo $containerid?>').load("<?php echo $_SERVER['REQUEST_URI']?>" + "&time=" + date.getTime());<?php endif;?>} });return;}}</script>
